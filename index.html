
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Movement Hub</title>
    <style>
              @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@800;900&display=swap');
              * { margin: 0; padding: 0; box-sizing: border-box; }
              body { margin: 0; padding: 0; overflow: hidden; font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-weight: 800; }
              .screen { width: 100vw; height: 100vh; background: linear-gradient(135deg,#1e3a8a 0%,#581c87 50%,#312e81 100%); position: relative; overflow: hidden; }
              .grid-bg { position: absolute; inset: 0; opacity: 0.12; background-image:
                linear-gradient(rgba(255,255,255,0.04) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
                background-size: 40px 40px, 40px 40px;
              }
              .player { position: absolute; width: 48px; height: 48px; background: linear-gradient(135deg,#22d3ee 0%,#3b82f6 100%); border-radius: 8px; box-shadow: 0 0 20px rgba(34,211,238,0.6); transition: left 80ms linear, top 80ms linear; overflow: hidden; }
              .hud { position: absolute; top: 16px; left: 16px; background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); color: white; padding: 12px 16px; border-radius: 8px; display:flex; gap:8px; flex-wrap:wrap; z-index:100; }
              .babies-button, .friends-button { background: linear-gradient(90deg,#22d3ee 0%,#3b82f6 100%); color: white; font-weight: bold; padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-size:14px; }
              .admin-button { background: linear-gradient(90deg,#f97316 0%,#ef4444 100%); color: white; font-weight: bold; padding: 8px 12px; border-radius: 6px; border: none; cursor: pointer; font-size:14px; }
              .babies-button:hover, .admin-button:hover, .friends-button:hover { transform: scale(1.03); }
              .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 3000; }
              .modal { background: rgba(0,0,0,0.9); border: 2px solid rgba(34,211,238,0.5); border-radius: 16px; padding: 24px; max-width: 900px; width: 92%; max-height: 85vh; overflow: auto; color: white; }
              .modal-title { color: #22d3ee; font-size: 22px; font-weight: bold; text-align: center; margin-bottom: 12px; }
              .character-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 12px; max-height: 60vh; overflow-y: auto; }
              .character-option { background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.12); border-radius: 12px; padding: 12px; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; }
              .character-option:hover { border-color: #22d3ee; transform: scale(1.03); }
              .character-option.selected { border-color: #22d3ee; background: rgba(34,211,238,0.12); box-shadow: 0 0 20px rgba(34,211,238,0.25); }
              .character-image { width: 100%; height: 120px; object-fit: contain; margin-bottom: 8px; border-radius: 8px; background: rgba(255,255,255,0.03); }
              .character-name { color: white; font-weight: bold; font-size: 14px; text-align: center; }
              .close-modal { background: rgba(255,255,255,0.08); color: white; border: 1px solid rgba(255,255,255,0.18); padding: 10px 16px; border-radius: 8px; cursor: pointer; margin-top: 12px; width: 100%; }
              .close-modal:hover { background: rgba(255,255,255,0.12); }
              .position { font-size: 11px; color: #9ca3af; margin-top: 8px; }
              .username-label { position: absolute; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); color: #22d3ee; padding: 4px 12px; border-radius: 6px; font-size: 14px; font-weight: bold; pointer-events: none; transform: translateX(-50%); white-space: nowrap; display:flex; flex-direction:column; align-items:center; gap:6px; }
              .username-label.admin { background: linear-gradient(90deg,#ff0000,#ff7f00,#ffff00,#00ff00,#0000ff,#4b0082,#8f00ff); color: white; box-shadow: 0 0 12px rgba(0,0,0,0.6); }
              .center-container { width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; }
              .welcome-box { background: rgba(0,0,0,0.5); backdrop-filter: blur(16px); border-radius: 16px; padding: 32px; max-width: 420px; width: 90%; border: 1px solid rgba(255,255,255,0.18); }
              .title { font-size: 36px; font-weight: bold; color: white; text-align: center; margin-bottom: 8px; }
              .subtitle { color: #d1d5db; text-align: center; margin-bottom: 16px; }
              .input { width: 100%; padding: 12px 16px; border-radius: 8px; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.2); color: white; font-size: 16px; margin-bottom: 12px; }
              .input:focus { border-color: #22d3ee; box-shadow: 0 0 0 2px rgba(34,211,238,0.18); outline:none; }
              .input::placeholder { color: #9ca3af; }
              .error { background: rgba(239,68,68,0.18); border: 1px solid #ef4444; color: #fecaca; padding: 10px 12px; border-radius: 8px; margin-bottom: 12px; font-size: 14px; }
              .button { width: 100%; background: linear-gradient(90deg,#22d3ee 0%,#3b82f6 100%); color: white; font-weight: bold; padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-size: 16px; }
              .button:hover { transform: translateY(-2px); }
              .rules { margin-top: 12px; text-align: center; font-size: 12px; color: #9ca3af; }
              .rules p { margin: 4px 0; }
              .admin-panel { display: flex; gap: 12px; }
              .admin-column { flex: 1; background: rgba(255,255,255,0.02); padding: 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.06); max-height: 60vh; overflow: auto; }
              .admin-row { display: flex; align-items: center; justify-content: space-between; padding: 8px; border-bottom: 1px dashed rgba(255,255,255,0.03); gap:8px; }
              .admin-row .meta { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
              .small-btn { padding:6px 8px; border-radius:6px; border:none; cursor:pointer; background:rgba(255,255,255,0.06); color:white; font-size:12px; white-space:nowrap; }
              .small-btn.warn { background: linear-gradient(90deg,#f97316,#ef4444); }
              .small-btn.ghost { background: rgba(255,255,255,0.04); }
              .small-btn:hover { transform:scale(1.05); }
              .muted { color:#9ca3af; font-size:13px; }
              .tab-row { display:flex; gap:8px; margin-bottom:8px; flex-wrap:wrap; }
              .tab { padding:6px 10px; border-radius:8px; background: rgba(255,255,255,0.03); cursor:pointer; font-weight:600; font-size:14px; }
              .tab.active { background: rgba(34,211,238,0.12); border:1px solid rgba(34,211,238,0.15); color:#22d3ee; }
              .mod-overlay {
                  position: fixed;
                  inset: 0;
                  z-index: 4000;
                  display: flex;
                  align-items: center;
                  justify-content: center;
                  background: rgba(0,0,0,0.85);
                  color: white;
                  flex-direction: column;
              }
              .mod-card {
                  text-align: center;
                  padding: 24px;
                  border-radius: 12px;
                  background: rgba(0,0,0,0.5);
                  border: 1px solid rgba(255,255,255,0.08);
                  min-width: 320px;
              }
              .mod-title { font-size: 28px; font-weight: 800; color: #ff6b6b; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
              .mod-desc { color: #e5e7eb; margin-bottom: 12px; }
              .mod-countdown { font-size: 20px; font-weight: 700; color: #ffd166; margin-bottom: 12px; }
              .flash-img {
                  width: 220px;
                  height: 220px;
                  object-fit: contain;
                  margin: 10px auto;
                  border-radius: 12px;
                  box-shadow: 0 6px 30px rgba(0,0,0,0.6);
                  animation: flashScale 1000ms infinite;
                  background: rgba(255,255,255,0.02);
              }
              @keyframes flashScale {
                  0% { transform: scale(1); opacity: 0.2; filter: hue-rotate(0deg); }
                  25% { transform: scale(1.06); opacity: 1; filter: hue-rotate(40deg); }
                  50% { transform: scale(1); opacity: 0.4; filter: hue-rotate(80deg); }
                  75% { transform: scale(1.04); opacity: 1; filter: hue-rotate(120deg); }
                  100% { transform: scale(1); opacity: 0.2; filter: hue-rotate(0deg); }
              }
              .mod-perm { color: #ff7b7b; font-weight: 700; margin-bottom: 10px; }
              .top-announcement {
                  position: fixed;
                  top: 18px;
                  left: 50%;
                  transform: translateX(-50%);
                  z-index: 2100;
                  background: linear-gradient(90deg, rgba(0,0,0,0.6), rgba(0,0,0,0.4));
                  color: #fff;
                  padding: 12px 20px;
                  border-radius: 10px;
                  border: 1px solid rgba(255,255,255,0.08);
                  box-shadow: 0 6px 30px rgba(0,0,0,0.6);
                  max-width: 80%;
                  text-align: center;
                  font-weight: 700;
                  letter-spacing: 0.2px;
                  animation: slideIn 300ms ease;
                  font-size: 16px;
              }
              .announce-ban { color: #ff9b9b; }
              .announce-timeout { color: #ffd58a; }
              @keyframes slideIn {
                  from { transform: translateX(-50%) translateY(-6px); opacity: 0; }
                  to { transform: translateX(-50%) translateY(0); opacity: 1; }
              }
              .orb-container {
                  position: fixed;
                  left: 50%;
                  top: 50%;
                  transform: translate(-50%, -50%);
                  z-index: 50;
                  display:flex;
                  align-items:center;
                  justify-content:center;
                  pointer-events: none;
              }
              .orb-img {
                  width: 140px;
                  height: 140px;
                  border-radius: 999px;
                  cursor: pointer;
                  pointer-events: auto;
                  transition: transform 140ms ease;
                  box-shadow: 0 12px 40px rgba(0,0,0,0.6);
              }
              .orb-img:active { transform: scale(0.97); }
              .orb-info {
                  position: fixed;
                  top: 64px;
                  left: 50%;
                  transform: translateX(-50%);
                  z-index: 60;
                  color: #fff;
                  font-weight: 900;
                  background: rgba(0,0,0,0.45);
                  padding: 8px 14px;
                  border-radius: 10px;
                  border: 1px solid rgba(255,255,255,0.06);
              }
              .orb-leaderboard {
                  position: fixed;
                  top: calc(64px + 46px);
                  left: 50%;
                  transform: translateX(-50%);
                  z-index: 60;
                  color: #fff;
                  background: rgba(0,0,0,0.45);
                  padding: 8px 12px;
                  border-radius: 10px;
                  border: 1px solid rgba(255,255,255,0.06);
                  width: 320px;
                  max-width: 40vw;
                  font-weight:700;
              }
              .orb-leaderboard h4 { margin-bottom: 6px; color:#ffd54a; font-weight:900; }
              .orb-row { display:flex; justify-content:space-between; gap:6px; font-weight:800; color:#fff; margin:2px 0; }
              .chat-box {
                  position: fixed;
                  right: 18px;
                  top: 18px;
                  width: 320px;
                  max-width: 38vw;
                  z-index: 2200;
                  background: linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.45));
                  border-radius: 12px;
                  border: 1px solid rgba(255,255,255,0.06);
                  padding: 8px;
                  color: white;
                  box-shadow: 0 8px 30px rgba(0,0,0,0.6);
                  backdrop-filter: blur(6px);
                  display: flex;
                  flex-direction: column;
              }
              .chat-header { display:flex; align-items:center; justify-content:space-between; font-weight: 800; margin: 6px 0 8px 0; color: #22d3ee; gap:8px; flex-wrap:wrap; }
              .chat-messages { display:flex; flex-direction:column-reverse; gap:8px; overflow:hidden; max-height: 220px; padding: 6px; }
              .chat-message { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.06); padding: 8px 10px; border-radius: 8px; font-size: 13px; word-break: break-word; position:relative; }
              .chat-meta { font-size: 11px; color: #9ca3af; margin-bottom: 4px; font-weight:700; display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
              .chat-tag { padding: 2px 6px; border-radius: 6px; color: #111; font-weight:800; font-size:11px; display:inline-block; white-space:nowrap; }
              .chat-tag.admin { color:white; font-weight:900; }
              .chat-input-row { display:flex; gap:8px; margin-top:8px; }
              .chat-input { flex: 1; padding: 8px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.06); background: rgba(255,255,255,0.02); color: white; outline: none; }
              .chat-send-btn { padding: 8px 12px; border-radius: 8px; border: none; background: linear-gradient(90deg,#22d3ee,#3b82f6); color: white; font-weight: 700; cursor: pointer; }
              .chat-send-btn:active { transform: translateY(1px); }
              .chat-recipient { padding:6px 8px; border-radius:6px; background: rgba(255,255,255,0.03); color:#cbd5e1; border:1px solid rgba(255,255,255,0.03); font-weight:800; font-size:13px; }
              .delete-msg-btn { position:absolute; top:4px; right:4px; padding:2px 6px; font-size:11px; background:rgba(255,0,0,0.4); border:none; border-radius:4px; color:white; cursor:pointer; }
              .delete-msg-btn:hover { background:rgba(255,0,0,0.6); }
              .speech-bubble {
                  position: absolute;
                  pointer-events: none;
                  transform: translateX(-50%);
                  background: rgba(255,255,255,0.92);
                  color: #111;
                  padding: 6px 10px;
                  border-radius: 12px;
                  box-shadow: 0 8px 20px rgba(0,0,0,0.4);
                  max-width: 240px;
                  font-weight: 700;
                  z-index: 1500;
                  font-size: 13px;
                  white-space: nowrap;
              }
              .speech-bubble::after {
                  content: '';
                  position: absolute;
                  left: 50%;
                  transform: translateX(-50%);
                  bottom: -6px;
                  border-width: 6px 6px 0 6px;
                  border-style: solid;
                  border-color: rgba(255,255,255,0.92) transparent transparent transparent;
              }
              .name-tag-bar {
                  width: 44px;
                  height: 8px;
                  border-radius: 8px;
                  box-shadow: 0 6px 20px rgba(0,0,0,0.45);
              }
              .friend-list { display:flex; flex-direction:column; gap:8px; }
              .friend-item { background: rgba(255,255,255,0.03); padding: 10px; border-radius: 8px; display:flex; justify-content:space-between; align-items:center; }
              .friend-name { font-weight: 700; }
              .friend-actions { display:flex; gap:6px; flex-wrap:wrap; }
             
              .mail-item { background: rgba(255,255,255,0.03); padding: 10px; border-radius: 8px; margin-bottom: 8px; }
              .mail-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; }
              .mail-from { font-weight: 700; color: #22d3ee; }
              .mail-time { font-size: 11px; color: #9ca3af; }
              .mail-body { font-size: 13px; color: #e5e7eb; }
             
              .group-item { background: rgba(255,255,255,0.03); padding: 10px; border-radius: 8px; margin-bottom: 8px; cursor:pointer; }
              .group-item:hover { background: rgba(255,255,255,0.06); }
              .group-name { font-weight: 700; color: #22d3ee; margin-bottom:4px; }
              .group-members { font-size: 11px; color: #9ca3af; }
                    /* Player Profile Styles */
      .player { cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
      .player:hover { transform: scale(1.12); box-shadow: 0 0 30px rgba(34,211,238,0.9); z-index: 10; }
      .profile-button { background: linear-gradient(90deg,#22d3ee 0%,#3b82f6 100%); color: white; font-weight: bold; padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-size:14px; }
      .profile-button:hover { transform: scale(1.03); }
      .profile-pic { width: 160px; height: 160px; border-radius: 50%; object-fit: cover; border: 5px solid #22d3ee; margin: 20px auto; box-shadow: 0 0 30px rgba(34,211,238,0.6); }
      .profile-character { width: 120px; height: 120px; object-fit: contain; margin: 16px auto; border-radius: 12px; background: rgba(255,255,255,0.05); padding: 8px; }
      .profile-info { margin: 12px 0; font-size: 18px; }
      .profile-info strong { color: #22d3ee; }
      .profile-image-input { width: 100%; padding: 12px; margin: 20px 0; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.2); color: white; border-radius: 8px; font-size: 14px; }
      .profile-image-input::placeholder { color: #9ca3af; }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
      import React from 'https://cdn.skypack.dev/react@18.2.0';
      import ReactDOM from 'https://cdn.skypack.dev/react-dom@18.2.0';
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
      import {
        getDatabase, ref, set, onValue, onDisconnect, get, remove, update, runTransaction, push
      } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
      const firebaseConfig = {
          apiKey: "AIzaSyBbgy76ThxHaKlOhpiLQ6Nw4ekR1b9t3DA",
          authDomain: "s0lace-web.firebaseapp.com",
          databaseURL: "https://s0lace-web-default-rtdb.firebaseio.com",
          projectId: "s0lace-web",
          storageBucket: "s0lace-web.firebasestorage.app",
          messagingSenderId: "13647464646",
          appId: "1:13647464646:web:87ecb82a32ab6f0efaafc7"
      };
      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const { useState, useEffect, useRef } = React;
      function MovementHub() {
          const [username, setUsername] = useState(null);
          const [inputUsername, setInputUsername] = useState('');
          const [error, setError] = useState('');
          const [position, setPosition] = useState({ x: 200, y: 200 });
          const [showModal, setShowModal] = useState(false);
          const [selectedCharacter, setSelectedCharacter] = useState('aurababy');
          const [players, setPlayers] = useState({});
          const [moderation, setModeration] = useState({ bans: {}, timeouts: {} });
          const [showAdminModal, setShowAdminModal] = useState(false);
          const [adminTab, setAdminTab] = useState('players');
          const [showFriendsModal, setShowFriendsModal] = useState(false);
          const [friendsTab, setFriendsTab] = useState('friends');
          const [friends, setFriends] = useState([]);
          const [friendRequests, setFriendRequests] = useState([]);
          const [blockedUsers, setBlockedUsers] = useState([]);
          const [mailbox, setMailbox] = useState([]);
          const [friendGroups, setFriendGroups] = useState([]);
          const [chatChannel, setChatChannel] = useState('all');
          const [announcement, setAnnouncement] = useState(null);
          const announceTimeoutRef = useRef(null);
          const [selfModeration, setSelfModeration] = useState(null);
          const [countdown, setCountdown] = useState(null);
          const [showProfileModal, setShowProfileModal] = useState(false);
          const [profileTarget, setProfileTarget] = useState(null); // null = my profile, else playerId
          const playerId = useRef(crypto.randomUUID());
          const renderRef = useRef({});
          const keysPressed = useRef({});
          const animationFrame = useRef(null);
          const SPEED = 4;
          const [chatMessages, setChatMessages] = useState([]);
          const [chatInput, setChatInput] = useState('');
          const CHAT_MAX = 50;
          const CHAT_COOLDOWN_MS = 5000;
          const BUBBLE_DURATION = 5000;
          const [nameTags, setNameTags] = useState({});
          const [bubbles, setBubbles] = useState({});
          const bubbleTimeouts = useRef({});
          const [orbCount, setOrbCount] = useState(0);
          const [orbLeaderboard, setOrbLeaderboard] = useState([]);
         
          const orbClickHistory = useRef([]);
          const ORB_RATE_LIMIT = 100;
          const ORB_RATE_WINDOW = 2000;
          const ORB_BAN_DURATION = 4 * 60 * 60 * 1000;
          const characters = {
              aurababy: { name: 'Aurababy', image: 'https://i.ibb.co/nq467xv6/aurababy.png' },
              goonerbaby: { name: 'Goonerbaby', image: 'https://i.ibb.co/ZRPGHj01/goonerbaby.png' },
              fattiebaby: { name: 'Fattie Baby', image: 'https://i.ibb.co/Kj0gKt2Q/fattiebaby.png' },
              zoely: { name: 'Zoely', image: 'https://i.ibb.co/PsXr9KgX/zoely.png' },
              hollybaby: { name: 'Holly Baby', image: 'https://i.ibb.co/DD8Py8yW/hollybaby.png' },
              jollybaby: { name: 'Jolly Baby', image: 'https://i.ibb.co/8DNHS4n9/jollybaby.png' },
              kingderrick_admin: { name: 'King Derrick', image: 'https://i.ibb.co/MyRFhbh7/kingderrick.png' },
              grant_admin: { name: 'Grant', image: 'https://i.ibb.co/KjmZGy3V/grant.png' },
              manny_admin: { name: 'Manny', image: 'https://i.ibb.co/0jjX9X56/manny.png' },
              daniel_admin: { name: 'Daniel', image: 'https://i.ibb.co/Gf47wYjN/daniel.png' },
              levi_admin: { name: 'Levi', image: 'https://i.ibb.co/XZPzfYNg/levi.png' },
              judgmentbaby: { name: 'Judgment Baby', image: 'https://i.ibb.co/Kxp9Vhz7/judgment.jpg' },
              baby_that_holds_aura: { name: 'The Baby That Holds Aura', image: 'https://i.ibb.co/jmTHJfh/The-Baby-That-Holds-Aura.jpg' },
              gangsta_baby: { name: 'Gangsta Baby', image: 'https://i.ibb.co/m5hpwbnt/gangstababy.jpg' }
          };
          const MOD_FLASH_IMAGE = 'https://i.ibb.co/Kxp9Vhz7/judgment.jpg';
          const adminNames = ['kingderrick', 'grant', 'manny', 'daniel', 'levi'];
          const ADMIN_PASSWORD = 'chickenfishfarting';
          const badWords = [
              'fuck','shit','damn','bitch','ass','asshole','bastard','crap',
              'piss','dick','cock','pussy','hell','whore','slut','fag',
              'nigger','nigga','retard','cunt','twat'
          ];
          const tagDefs = {
              gold: { label: 'Supporter', color: '#FFD700', textColor: '#111' },
              green: { label: 'VERY Early Supporter', color: '#00C851', textColor: '#061a09' },
              red: { label: 'Opp', color: '#FF4D4D', textColor: '#111' },
              purple: { label: 'Vip', color: '#8E44AD', textColor: '#fff' },
              black: { label: 'Zesty Besty', color: '#111111', textColor: '#fff' },
              friend: { label: 'Friend', color: '#10B981', textColor: '#fff' },
              timedout: { label: 'Timed Out', color: '#FFA500', textColor: '#111' }
          };
          const containsBadWord = (text) => {
              const lowerText = (text || '').toLowerCase();
              return badWords.some(word => lowerText.includes(word));
          };
          const durationMs = (label) => {
              if (!label || label === 'perm') return null;
             
              let total = 0;
              const parts = label.split('-');
              for (const part of parts) {
                  const match = part.match(/^(\d+)([smhd])$/);
                  if (!match) continue;
                  const value = parseInt(match[1]);
                  const unit = match[2];
                 
                  switch (unit) {
                      case 's': total += value * 1000; break;
                      case 'm': total += value * 60 * 1000; break;
                      case 'h': total += value * 60 * 60 * 1000; break;
                      case 'd': total += value * 24 * 60 * 60 * 1000; break;
                  }
              }
              return total > 0 ? total : null;
          };
          const showAnnouncement = (text, type = 'info') => {
              setAnnouncement({ text, type });
              if (announceTimeoutRef.current) clearTimeout(announceTimeoutRef.current);
              announceTimeoutRef.current = setTimeout(() => {
                  setAnnouncement(null);
                  announceTimeoutRef.current = null;
              }, 7000);
          };
          const validateAndFetchModerationEntry = async (path, key) => {
              const nodeRef = ref(db, `${path}/${key}`);
              const snap = await get(nodeRef);
              if (!snap.exists()) return null;
              const data = snap.val();
              if (data.expiresAt && Date.now() > data.expiresAt) {
                  await remove(nodeRef);
                  return null;
              }
              return data;
          };
          const removePlayerByUsername = async (target) => {
              const lowerTarget = target.toLowerCase();
              for (const [id, p] of Object.entries(players || {})) {
                  if ((p.username || '').toLowerCase() === lowerTarget) {
                      await set(ref(db, `players/${id}`), null);
                  }
              }
          };
          const applyModeration = async (targetUsername, type, durationLabel, reason = '') => {
              if (!username) return alert('You are not signed in as admin.');
              const isAdmin = adminNames.includes((username || '').toLowerCase());
              if (!isAdmin) return alert('Only admins can perform this action.');
              const key = targetUsername.toLowerCase();
              const ms = durationMs(durationLabel);
              const now = Date.now();
              const payload = {
                  moderator: username,
                  target: targetUsername,
                  appliedAt: now,
                  expiresAt: ms == null ? null : now + ms,
                  reason: reason || 'No reason provided'
              };
              if (type === 'ban') {
                  await set(ref(db, `moderation/bans/${key}`), payload);
                  await removePlayerByUsername(targetUsername);
                  showAnnouncement(`${targetUsername} was BANNED by ${username}${reason ? ': ' + reason : ''}`, 'ban');
              } else if (type === 'timeout') {
                  await set(ref(db, `moderation/timeouts/${key}`), payload);
                  showAnnouncement(`${targetUsername} was TIMED OUT by ${username}${reason ? ': ' + reason : ''}`, 'timeout');
              }
          };
          const removeModeration = async (targetUsername, type) => {
              const key = targetUsername.toLowerCase();
              if (type === 'ban') {
                  await remove(ref(db, `moderation/bans/${key}`));
                  showAnnouncement(`${targetUsername} was UNBANNED by ${username}`, 'info');
              } else if (type === 'timeout') {
                  await remove(ref(db, `moderation/timeouts/${key}`));
                  showAnnouncement(`${targetUsername} timeout was REMOVED by ${username}`, 'info');
              }
          };
          const deleteMessage = async (msgId) => {
              try {
                  await remove(ref(db, `chat/channels/${chatChannel}/messages/${msgId}`));
              } catch (err) {
                  console.error('Failed to delete message', err);
              }
          };
          const sendFriendRequest = async (targetUsername) => {
              if (!username) return;
              const lower = username.toLowerCase();
              const targetLower = targetUsername.toLowerCase();
             
              if (lower === targetLower) return alert('Cannot add yourself as friend');
              if (friends.includes(targetLower)) return alert('Already friends');
             
              await set(ref(db, `friends/${targetLower}/requests/${lower}`), {
                  from: username,
                  ts: Date.now()
              });
              showAnnouncement(`Friend request sent to ${targetUsername}`, 'info');
          };
          const acceptFriendRequest = async (requesterUsername) => {
              if (!username) return;
              const lower = username.toLowerCase();
              const requesterLower = requesterUsername.toLowerCase();
             
              await set(ref(db, `friends/${lower}/friendsList/${requesterLower}`), true);
              await set(ref(db, `friends/${requesterLower}/friendsList/${lower}`), true);
              await remove(ref(db, `friends/${lower}/requests/${requesterLower}`));
             
              showAnnouncement(`You are now friends with ${requesterUsername}`, 'info');
          };
          const removeFriend = async (friendUsername) => {
              if (!username) return;
              const lower = username.toLowerCase();
              const friendLower = friendUsername.toLowerCase();
             
              await remove(ref(db, `friends/${lower}/friendsList/${friendLower}`));
              await remove(ref(db, `friends/${friendLower}/friendsList/${lower}`));
             
              showAnnouncement(`Removed ${friendUsername} from friends`, 'info');
          };
          const blockUser = async (targetUsername) => {
              if (!username) return;
              const lower = username.toLowerCase();
              const targetLower = targetUsername.toLowerCase();
             
              await set(ref(db, `blocked/${lower}/${targetLower}`), true);
              showAnnouncement(`Blocked ${targetUsername}`, 'info');
          };
          const unblockUser = async (targetUsername) => {
              if (!username) return;
              const lower = username.toLowerCase();
              const targetLower = targetUsername.toLowerCase();
             
              await remove(ref(db, `blocked/${lower}/${targetLower}`));
              showAnnouncement(`Unblocked ${targetUsername}`, 'info');
          };
          const sendMailToFriend = async (friendUsername, message) => {
              if (!username) return;
              if (!message.trim()) return alert('Message cannot be empty');
             
              const friendLower = friendUsername.toLowerCase();
              const mailRef = push(ref(db, `friends/${friendLower}/mailbox`));
              await set(mailRef, {
                  from: username,
                  text: message,
                  ts: Date.now()
              });
             
              showAnnouncement(`Mail sent to ${friendUsername}`, 'info');
          };
          const deleteMail = async (mailId) => {
              if (!username) return;
              const lower = username.toLowerCase();
              await remove(ref(db, `friends/${lower}/mailbox/${mailId}`));
          };
          const createFriendGroup = async (groupName, members) => {
              if (!username) return;
              if (!groupName.trim()) return alert('Group name cannot be empty');
              if (members.length < 2) return alert('Need at least 2 members');
             
              const lower = username.toLowerCase();
              const membersList = [lower, ...members.map(m => m.toLowerCase())];
             
              const groupRef = push(ref(db, 'friendGroups'));
              await set(groupRef, {
                  name: groupName,
                  creator: username,
                  members: membersList,
                  ts: Date.now()
              });
             
              showAnnouncement(`Created group: ${groupName}`, 'info');
          };
          const handleUsernameSubmit = async (e) => {
              if (e && e.preventDefault) e.preventDefault();
              setError('');
              const trimmedUsername = inputUsername.trim();
              if (trimmedUsername.length < 3) {
                  setError('Username must be at least 3 characters');
                  return;
              }
              if (trimmedUsername.length > 20) {
                  setError('Username must be 20 characters or less');
                  return;
              }
              if (!/^[a-zA-Z0-9_]+$/.test(trimmedUsername)) {
                  setError('Username can only contain letters, numbers, and underscores');
                  return;
              }
              if (containsBadWord(trimmedUsername)) {
                  setError('Username contains inappropriate language');
                  return;
              }
              const lower = trimmedUsername.toLowerCase();
              if (adminNames.includes(lower)) {
                  const pw = window.prompt('Enter admin password for ' + trimmedUsername + ':', '');
                  if (pw !== ADMIN_PASSWORD) {
                      setError('Incorrect admin password');
                      return;
                  }
              }
              try {
                  const ban = await validateAndFetchModerationEntry('moderation/bans', lower);
                  if (ban) {
                      if (ban.expiresAt == null) {
                          setError(`Permanently banned. Reason: ${ban.reason || 'No reason'}`);
                          return;
                      } else {
                          const remaining = Math.max(0, ban.expiresAt - Date.now());
                          setError(`Banned for ${Math.ceil(remaining / 1000)}s. Reason: ${ban.reason || 'No reason'}`);
                          return;
                      }
                  }
              } catch (err) {
                  console.error('Moderation check error', err);
              }
              localStorage.setItem('movement_hub_username', trimmedUsername);
              setUsername(trimmedUsername);
          };
          useEffect(() => {
              const stored = localStorage.getItem('movement_hub_username');
              if (stored) setUsername(stored);
          }, []);
          useEffect(() => {
              const bansRef = ref(db, 'moderation/bans');
              const timeoutsRef = ref(db, 'moderation/timeouts');
              onValue(bansRef, snapshot => {
                  const val = snapshot.val() || {};
                  const next = {};
                  for (const [k, v] of Object.entries(val)) {
                      if (v.expiresAt && Date.now() > v.expiresAt) {
                          remove(ref(db, `moderation/bans/${k}`));
                      } else next[k] = v;
                  }
                  setModeration(prev => ({ ...prev, bans: next }));
              });
              onValue(timeoutsRef, snapshot => {
                  const val = snapshot.val() || {};
                  const next = {};
                  for (const [k, v] of Object.entries(val)) {
                      if (v.expiresAt && Date.now() > v.expiresAt) {
                          remove(ref(db, `moderation/timeouts/${k}`));
                      } else next[k] = v;
                  }
                  setModeration(prev => ({ ...prev, timeouts: next }));
              });
          }, []);
          useEffect(() => {
              if (!username) return;
              const lower = username.toLowerCase();
              const banRef = ref(db, `moderation/bans/${lower}`);
              onValue(banRef, snapshot => {
                  const val = snapshot.val();
                  if (val) {
                      set(ref(db, `players/${playerId.current}`), null);
                      setSelfModeration({ type: 'ban', ...val });
                  } else {
                      setSelfModeration(prev => (prev && prev.type === 'ban' ? null : prev));
                  }
              });
          }, [username]);
          useEffect(() => {
              if (!selfModeration) {
                  setCountdown(null);
                  return;
              }
              const update = () => {
                  if (!selfModeration) return;
                  if (!selfModeration.expiresAt) {
                      setCountdown(null);
                      return;
                  }
                  const remain = Math.max(0, selfModeration.expiresAt - Date.now());
                  setCountdown(remain);
                  if (remain <= 0) {
                      setSelfModeration(null);
                      setCountdown(null);
                  }
              };
              update();
              const id = setInterval(update, 1000);
              return () => clearInterval(id);
          }, [selfModeration]);
          useEffect(() => {
              if (!username) return;
              const handleKeyDown = (e) => {
                  const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : null;
                  const isEditable = tag === 'input' || tag === 'textarea' || e.target && e.target.isContentEditable;
                  if (isEditable) return;
                  const key = e.key.toLowerCase();
                  if (['w','a','s','d','arrowup','arrowdown','arrowleft','arrowright'].includes(key)) {
                      if (selfModeration && (!selfModeration.expiresAt || Date.now() < selfModeration.expiresAt)) {
                          e.preventDefault();
                          return;
                      }
                      e.preventDefault();
                      keysPressed.current[key] = true;
                  }
              };
             
              const handleKeyUp = (e) => {
                  const tag = (e.target && e.target.tagName) ? e.target.tagName.toLowerCase() : null;
                  const isEditable = tag === 'input' || tag === 'textarea' || e.target && e.target.isContentEditable;
                  if (isEditable) return;
                  const key = e.key.toLowerCase();
                  keysPressed.current[key] = false;
              };
              const updatePosition = () => {
                  if (selfModeration && (!selfModeration.expiresAt || Date.now() < selfModeration.expiresAt)) {
                      animationFrame.current = requestAnimationFrame(updatePosition);
                      return;
                  }
                  setPosition(prev => {
                      let moveX = 0, moveY = 0;
                      if (keysPressed.current['w'] || keysPressed.current['arrowup']) moveY -= 1;
                      if (keysPressed.current['s'] || keysPressed.current['arrowdown']) moveY += 1;
                      if (keysPressed.current['a'] || keysPressed.current['arrowleft']) moveX -= 1;
                      if (keysPressed.current['d'] || keysPressed.current['arrowright']) moveX += 1;
                      if (moveX !== 0 && moveY !== 0) {
                          const len = Math.sqrt(moveX*moveX + moveY*moveY);
                          moveX = (moveX / len) * SPEED;
                          moveY = (moveY / len) * SPEED;
                      } else { moveX *= SPEED; moveY *= SPEED; }
                      let newX = prev.x + moveX;
                      let newY = prev.y + moveY;
                      newX = Math.max(0, Math.min(window.innerWidth - 50, newX));
                      newY = Math.max(0, Math.min(window.innerHeight - 50, newY));
                      return { x: newX, y: newY };
                  });
                  animationFrame.current = requestAnimationFrame(updatePosition);
              };
              window.addEventListener('keydown', handleKeyDown);
              window.addEventListener('keyup', handleKeyUp);
              animationFrame.current = requestAnimationFrame(updatePosition);
              return () => {
                  window.removeEventListener('keydown', handleKeyDown);
                  window.removeEventListener('keyup', handleKeyUp);
                  if (animationFrame.current) cancelAnimationFrame(animationFrame.current);
              };
          }, [username, selfModeration]);
          useEffect(() => {
              if (!username) return;
              if (selfModeration && (!selfModeration.expiresAt || Date.now() < selfModeration.expiresAt)) {
                  set(ref(db, `players/${playerId.current}`), null);
                  return;
              }
              const playerRef = ref(db, `players/${playerId.current}`);
              set(playerRef, {
                  username,
                  x: position.x,
                  y: position.y,
                  character: selectedCharacter,
                  admin: adminNames.includes(username.toLowerCase())
              });
              onDisconnect(playerRef).remove();
          }, [username, selfModeration]);
          useEffect(() => {
              if (!username) return;
              const playerRef = ref(db, `players/${playerId.current}`);
              const interval = setInterval(() => {
                  if (selfModeration && (!selfModeration.expiresAt || Date.now() < selfModeration.expiresAt)) {
                      set(playerRef, null);
                      return;
                  }
                  set(playerRef, {
                      username,
                      x: position.x,
                      y: position.y,
                      character: selectedCharacter,
                      admin: adminNames.includes(username.toLowerCase())
                  });
              }, 66);
              return () => clearInterval(interval);
          }, [username, position.x, position.y, selectedCharacter, selfModeration]);
          useEffect(() => {
              const playersRef = ref(db, 'players');
              return onValue(playersRef, snapshot => {
                  setPlayers(snapshot.val() || {});
              });
          }, []);
          // Profile tracking: time spent + aura + character + join date
          useEffect(() => {
              if (!username) return;
              const profileRef = ref(db, `profiles/${username.toLowerCase()}`);
              // Initialize or update profile
              const initProfile = async () => {
                  const snap = await get(profileRef);
                  if (!snap.exists()) {
                      set(profileRef, {
                          joinDate: Date.now(),
                          timeSpent: 0,
                          auraClicks: 0,
                          character: selectedCharacter,
                          profileImage: ''
                      });
                  }
              };
              initProfile();
              // Update time every minute
              const timer = setInterval(() => {
                  runTransaction(profileRef, (profile) => {
                      if (profile) {
                          profile.timeSpent = (profile.timeSpent || 0) + 60;
                          profile.character = selectedCharacter;
                      }
                      return profile;
                  });
              }, 60000);
              // Update aura clicks when orb is clicked (connect to your existing orb click handler later)
              return () => clearInterval(timer);
          }, [username, selectedCharacter]);
          useEffect(() => {
              const next = {};
              for (const [id, p] of Object.entries(players || {})) {
                  if (id === playerId.current) {
                      next[id] = { x: position.x, y: position.y, username, character: selectedCharacter, admin: adminNames.includes((username || '').toLowerCase()) };
                  } else {
                      const prev = renderRef.current[id] || p;
                      next[id] = {
                          x: prev.x + (p.x - prev.x) * 0.25,
                          y: prev.y + (p.y - prev.y) * 0.25,
                          username: p.username,
                          character: p.character,
                          admin: p.admin || adminNames.includes((p.username || '').toLowerCase())
                      };
                  }
              }
              renderRef.current = next;
          }, [players, position, username, selectedCharacter]);
          useEffect(() => {
              if (!username) return;
              const lower = username.toLowerCase();
              const friendsRef = ref(db, `friends/${lower}/friendsList`);
              onValue(friendsRef, snapshot => {
                  const val = snapshot.val() || {};
                  setFriends(Object.keys(val));
              });
              const requestsRef = ref(db, `friends/${lower}/requests`);
              onValue(requestsRef, snapshot => {
                  const val = snapshot.val() || {};
                  setFriendRequests(Object.keys(val));
              });
              const blockedRef = ref(db, `blocked/${lower}`);
              onValue(blockedRef, snapshot => {
                  const val = snapshot.val() || {};
                  setBlockedUsers(Object.keys(val));
              });
              const mailRef = ref(db, `friends/${lower}/mailbox`);
              onValue(mailRef, snapshot => {
                  const val = snapshot.val() || {};
                  const arr = Object.entries(val).map(([k,v]) => ({ id: k, ...v })).sort((a,b) => (b.ts||0) - (a.ts||0));
                  setMailbox(arr);
              });
              const groupsRef = ref(db, 'friendGroups');
              onValue(groupsRef, snapshot => {
                  const val = snapshot.val() || {};
                  const myGroups = Object.entries(val)
                      .filter(([_, g]) => (g.members || []).includes(lower))
                      .map(([id, g]) => ({ id, ...g }));
                  setFriendGroups(myGroups);
              });
              const tagsRef = ref(db, 'nameTags');
              onValue(tagsRef, snapshot => {
                  setNameTags(snapshot.val() || {});
              });
              const orbCountRef = ref(db, 'orb/count');
              onValue(orbCountRef, snapshot => {
                  setOrbCount(snapshot.val() || 0);
              });
              const orbClicksRef = ref(db, 'orb/clicks');
              onValue(orbClicksRef, snapshot => {
                  const val = snapshot.val() || {};
                  const arr = Object.entries(val).map(([username, count]) => ({ username, count })).sort((a,b) => b.count - a.count);
                  setOrbLeaderboard(arr.slice(0,5));
              });
          }, [username]);
          useEffect(() => {
              if (!username) return;
             
             
             
              const msgsRef = ref(db, `chat/channels/${chatChannel}/messages`);
              onValue(msgsRef, snapshot => {
                  const val = snapshot.val() || {};
                  const arr = Object.entries(val).map(([k,v]) => ({ id: k, ...v })).sort((a,b) => (a.ts||0) - (b.ts||0));
                 
                  const filtered = arr.filter(m => {
                      const senderLower = (m.username || '').toLowerCase();
                      if (blockedUsers.includes(senderLower)) return false;
                      return true;
                  }).slice(-CHAT_MAX);
                 
                  setChatMessages(filtered);
                  const now = Date.now();
                  arr.forEach(m => {
                      if (blockedUsers.includes((m.username || '').toLowerCase())) return;
                      if (!m.playerId) return;
                      const expiresAt = (m.ts || now) + BUBBLE_DURATION;
                      if (expiresAt > now) {
                          setBubbles(prev => {
                              if (prev[m.playerId] && prev[m.playerId].id === m.id) return prev;
                              const next = { ...prev, [m.playerId]: { id: m.id, text: m.text, expiresAt } };
                              return next;
                          });
                          if (bubbleTimeouts.current[m.playerId]) {
                              clearTimeout(bubbleTimeouts.current[m.playerId]);
                          }
                          const remaining = Math.max(0, expiresAt - Date.now());
                          bubbleTimeouts.current[m.playerId] = setTimeout(() => {
                              setBubbles(prev => {
                                  const cp = { ...prev };
                                  if (cp[m.playerId] && cp[m.playerId].id === m.id) delete cp[m.playerId];
                                  return cp;
                              });
                              delete bubbleTimeouts.current[m.playerId];
                          }, remaining);
                      }
                  });
              });
          }, [username, chatChannel, blockedUsers]);
          const assignTag = async (targetUsername, tagKey) => {
              if (!username) return alert('Sign in as admin to assign tags.');
              if (!adminNames.includes((username || '').toLowerCase())) return alert('Only admins can assign tags.');
              const lower = (targetUsername || '').toLowerCase();
              if (!tagKey || tagKey === 'none') {
                  await set(ref(db, `nameTags/${lower}`), null);
                  showAnnouncement(`${targetUsername} tag removed by ${username}`, 'info');
              } else {
                  if (!tagDefs[tagKey]) return alert('Unknown tag');
                  await set(ref(db, `nameTags/${lower}`), tagKey);
                  showAnnouncement(`${targetUsername} was given the ${tagKey} tag by ${username}`, 'info');
              }
          };
          const handleChatChange = (e) => {
              let v = e.target.value || '';
              v = v.toLowerCase();
              v = v.replace(/[^a-z ]/g, '');
              setChatInput(v);
          };
          const handleChatSend = async (e) => {
              if (e && e.preventDefault) e.preventDefault();
              if (!username) return;
             
              const lower = username.toLowerCase();
              const timeoutEntry = moderation.timeouts[lower];
              if (timeoutEntry && (!timeoutEntry.expiresAt || Date.now() < timeoutEntry.expiresAt)) {
                  return alert('You are timed out and cannot chat.');
              }
             
              let text = (chatInput || '').trim();
              if (!text) return;
             
              if (text === '/clear') {
                  setChatMessages([]);
                  setChatInput('');
                  return;
              }
             
              if (text.length > 200) return alert('Message too long (200 chars max)');
              if (containsBadWord(text)) return alert('Message contains inappropriate language');
              try {
                  const lastRef = ref(db, `chat/lastChat/${lower}`);
                  const lastSnap = await get(lastRef);
                  const last = lastSnap.exists() ? (lastSnap.val() || 0) : 0;
                  const now = Date.now();
                  if (now - last < CHAT_COOLDOWN_MS) {
                      const rem = Math.ceil((CHAT_COOLDOWN_MS - (now - last)) / 1000);
                      return alert(`Please wait ${rem}s before sending another message.`);
                  }
                  const id = crypto.randomUUID();
                  const msg = {
                      username,
                      text,
                      ts: now,
                      playerId: playerId.current
                  };
                  await set(ref(db, `chat/channels/${chatChannel}/messages/${id}`), msg);
                  await set(lastRef, now);
              } catch (err) {
                  console.error('failed to send message', err);
                  alert('Failed to send  try again.');
              }
              setChatInput('');
          };
          const onChatKeyDown = (e) => {
              if (e.key === 'Enter') {
                  e.preventDefault();
                  handleChatSend();
              }
          };
          const handleOrbClick = async () => {
              if (!username) {
                  showAnnouncement('Sign in to click the orb', 'info');
                  return;
              }
              const lower = username.toLowerCase();
              const userProfileRef = ref(db, `profiles/${lower}`);
              runTransaction(userProfileRef, (profile) => {
                  if (profile) profile.auraClicks = (profile.auraClicks || 0) + 1;
                  return profile;
              });
              if (selfModeration && (!selfModeration.expiresAt || Date.now() < selfModeration.expiresAt)) {
                  return showAnnouncement('You are moderated and cannot click the orb', 'info');
              }
             
              const now = Date.now();
              orbClickHistory.current.push(now);
              orbClickHistory.current = orbClickHistory.current.filter(t => now - t < ORB_RATE_WINDOW);
             
              if (orbClickHistory.current.length > ORB_RATE_LIMIT) {
                  const lower = username.toLowerCase();
                  await applyModeration(username, 'ban', '4h', 'Clicking orb too fast (auto-ban)');
                  return;
              }
             
              try {
                  const countRef = ref(db, 'orb/count');
                  await runTransaction(countRef, (current) => {
                      return (current || 0) + 1;
                  });
                  const lower = username.toLowerCase();
                  const userClickRef = ref(db, `orb/clicks/${lower}`);
                  await runTransaction(userClickRef, (current) => {
                      return (current || 0) + 1;
                  });
                  showAnnouncement(`+1 Aura!`, 'info');
              } catch (err) {
                  console.error('orb click failed', err);
              }
          };
          function ProfileModal({ profileTarget, username, selectedCharacter, players, onClose }) {
              const [profileData, setProfileData] = useState({});
              const targetUsername = profileTarget ? players[profileTarget]?.username : username;
              const isOwnProfile = targetUsername.toLowerCase() === username.toLowerCase();
              useEffect(() => {
                  if (!targetUsername) return;
                  const profRef = ref(db, `profiles/${targetUsername.toLowerCase()}`);
                  const unsub = onValue(profRef, (snap) => {
                      setProfileData(snap.val() || {});
                  });
                  return unsub;
              }, [targetUsername]);
              const formatTime = (sec) => {
                  if (!sec) return '0m';
                  const h = Math.floor(sec / 3600);
                  const m = Math.floor((sec % 3600) / 60);
                  return h > 0 ? `${h}h ${m}m` : `${m}m`;
              };
              const formatDate = (ts) => new Date(ts).toLocaleDateString(undefined, { month: 'long', day: 'numeric', year: 'numeric' });
              return React.createElement('div', { className: 'modal', onClick: (e) => e.stopPropagation() },
                  React.createElement('div', { className: 'modal-title' },
                      isOwnProfile ? 'My Profile' : (targetUsername + "'s Profile")
                  ),
                  React.createElement('img', {
                      src: profileData.profileImage || characters[profileData.character || selectedCharacter]?.image || characters['aurababy'].image,
                      className: 'profile-pic',
                      alt: 'Profile Picture'
                  }),
                  React.createElement('img', {
                      src: characters[profileData.character || selectedCharacter]?.image,
                      className: 'profile-character',
                      alt: 'Current Baby'
                  }),
                  React.createElement('div', { className: 'profile-info' }, React.createElement('strong', null, 'Username: '), targetUsername),
                  React.createElement('div', { className: 'profile-info' }, React.createElement('strong', null, 'Member Since: '), profileData.joinDate ? formatDate(profileData.joinDate) : 'Today'),
                  React.createElement('div', { className: 'profile-info' }, React.createElement('strong', null, 'Time on AuraBabyHub: '), formatTime(profileData.timeSpent || 0)),
                  React.createElement('div', { className: 'profile-info' }, React.createElement('strong', null, 'Aura Contributed: '), profileData.auraClicks || 0),
                  isOwnProfile && React.createElement('input', {
                      type: 'text',
                      className: 'profile-image-input',
                      placeholder: 'Paste image URL & press Enter to set profile picture',
                      onKeyDown: (e) => {
                          if (e.key === 'Enter') {
                              const url = e.target.value.trim();
                              update(ref(db, `profiles/${username.toLowerCase()}`), { profileImage: url || null });
                              e.target.value = '';
                          }
                      }
                  }),
                  React.createElement('button', { className: 'close-modal', onClick: onClose }, 'Close')
              );
          }
          if (!username) {
              return React.createElement('div', { className: 'screen center-container' },
                  React.createElement('div', { className: 'welcome-box' },
                      React.createElement('h1', { className: 'title' }, 'Welcome!'),
                      React.createElement('p', { className: 'subtitle' }, 'Choose your username to begin'),
                      React.createElement('form', { onSubmit: handleUsernameSubmit },
                          React.createElement('input', {
                              type: 'text', value: inputUsername, onChange: (e) => setInputUsername(e.target.value),
                              placeholder: 'Enter username', className: 'input', maxLength: 20, autoFocus: true
                          }),
                          error && React.createElement('div', { className: 'error' }, error),
                          React.createElement('button', { type: 'submit', className: 'button' }, 'Start Playing')
                      ),
                      React.createElement('div', { className: 'rules' },
                          React.createElement('p', null, ' 3-20 characters'),
                          React.createElement('p', null, ' Letters, numbers, and underscores only'),
                          React.createElement('p', null, ' No inappropriate language')
                      )
                  )
              );
          }
          const isAdminUser = adminNames.includes((username || '').toLowerCase());
          const uniquePlayerUsernames = [...new Set(Object.values(players || {}).map(p => p.username).filter(Boolean))];
         
          const isTimedOut = moderation.timeouts[(username || '').toLowerCase()];
          const timedOutRemaining = isTimedOut && isTimedOut.expiresAt ? Math.max(0, isTimedOut.expiresAt - Date.now()) : null;
          const formatRemaining = (ms) => {
              if (ms == null) return 'Permanent';
              if (ms <= 1000) return '0s';
              const totalSec = Math.ceil(ms / 1000);
              if (totalSec < 60) return `${totalSec}s`;
              const minutes = Math.floor(totalSec / 60);
              const seconds = totalSec % 60;
              if (minutes < 60) return `${minutes}:${String(seconds).padStart(2,'0')}`;
              const hours = Math.floor(minutes / 60);
              const minsRem = minutes % 60;
              if (hours < 24) return `${hours}h ${minsRem}m`;
              const days = Math.floor(hours / 24);
              return `${days}d`;
          };
          const renderChatTag = (u) => {
              const lower = (u || '').toLowerCase();
              if (adminNames.includes(lower)) {
                  return React.createElement('span', { className: 'chat-tag admin', style: { background: 'linear-gradient(90deg,#ff0000,#ff7f00,#ffff00,#00ff00,#0000ff,#4b0082,#8f00ff)', color: '#fff', fontWeight: 900 } }, 'ADMIN');
              }
             
              if (moderation.timeouts[lower]) {
                  const def = tagDefs.timedout;
                  return React.createElement('span', { className: 'chat-tag', style: { background: def.color, color: def.textColor } }, def.label);
              }
             
              if (friends.includes(lower)) {
                  const def = tagDefs.friend;
                  return React.createElement('span', { className: 'chat-tag', style: { background: def.color, color: def.textColor } }, def.label);
              }
             
              const t = nameTags[lower];
              if (!t) return null;
              const def = tagDefs[t];
              if (!def) return null;
              return React.createElement('span', { className: 'chat-tag', style: { background: def.color, color: def.textColor } }, def.label);
          };
          const renderNameTagBar = (u, isAdminFlag) => {
              const lower = (u || '').toLowerCase();
              if (isAdminFlag) {
                  return React.createElement('div', { className: 'name-tag-bar', style: { background: 'linear-gradient(90deg,#ff0000,#ff7f00,#ffff00,#00ff00,#0000ff,#4b0082,#8f00ff)' } });
              }
             
              if (moderation.timeouts[lower]) {
                  return React.createElement('div', { className: 'name-tag-bar', style: { background: tagDefs.timedout.color } });
              }
             
              if (friends.includes(lower)) {
                  return React.createElement('div', { className: 'name-tag-bar', style: { background: tagDefs.friend.color } });
              }
             
              const t = nameTags[lower];
              if (!t) return null;
              const def = tagDefs[t];
              if (!def) return null;
              return React.createElement('div', { className: 'name-tag-bar', style: { background: def.color } });
          };
          const hideOrb = showModal || showAdminModal || showFriendsModal || selfModeration;
          return React.createElement('div', { className: 'screen' },
              React.createElement('div', { className: 'grid-bg' }),
              announcement && React.createElement('div', {
                  className: `top-announcement ${announcement.type === 'ban' ? 'announce-ban' : announcement.type === 'timeout' ? 'announce-timeout' : ''}`
              }, announcement.text),
              !hideOrb && React.createElement(React.Fragment, null,
                  React.createElement('div', { className: 'orb-info' }, `Orbs Aura: ${orbCount}`),
                  React.createElement('div', { className: 'orb-leaderboard' },
                      React.createElement('h4', null, 'Aura Leaderboard'),
                      orbLeaderboard.length === 0 ? React.createElement('div', { className: 'muted' }, 'No clicks yet') :
                          orbLeaderboard.map((r, idx) => React.createElement('div', { key: r.username, className: 'orb-row' },
                              React.createElement('div', null, `${idx+1}. ${r.username}`),
                              React.createElement('div', null, r.count)
                          ))
                  ),
                  React.createElement('div', { className: 'orb-container' },
                      React.createElement('img', {
                          src: 'https://i.ibb.co/KPY69kc/aura-orb.png',
                          alt: 'Orb of Aura',
                          className: 'orb-img',
                          onClick: handleOrbClick,
                          onError: (e) => { e.target.style.display = 'none'; }
                      })
                  )
              ),
              Object.entries(renderRef.current).map(([id, p]) =>
                  React.createElement(React.Fragment, { key: id },
                      React.createElement('div', {
                          key: id,
                          className: 'player',
                          style: { left: `${p.x}px`, top: `${p.y}px` },
                          onClick: () => {
                              setProfileTarget(id);
                              setShowProfileModal(true);
                          }
                      },
                          React.createElement('img', {
                              src: characters[p.character]?.image || characters['aurababy'].image,
                              alt: p.character,
                              style: { width: '100%', height: '100%', objectFit: 'contain', borderRadius: '8px' },
                              onError: (e) => { e.target.src = characters['aurababy'].image; }
                          })
                      ),
                      React.createElement('div', {
                          className: 'username-label' + (p.admin ? ' admin' : ''),
                          style: { left: `${p.x + 24}px`, top: `${p.y + 58}px` }
                      },
                          React.createElement('span', null, p.username),
                          renderNameTagBar(p.username, p.admin)
                      ),
                      bubbles[id] ? React.createElement('div', {
                          className: 'speech-bubble',
                          style: { left: `${p.x + 24}px`, top: `${p.y - 18}px` }
                      }, bubbles[id].text) : null
                  )
              ),
              React.createElement('div', { className: 'hud' },
                  React.createElement('button', { className: 'babies-button', onClick: () => setShowModal(true) }, ' Babies'),
                  React.createElement('button', { className: 'friends-button', onClick: () => setShowFriendsModal(true) }, ' Friends'),
                  React.createElement('button', {
                      className: 'profile-button',
                      onClick: () => {
                          setProfileTarget(null);
                          setShowProfileModal(true);
                      }
                  }, ' My Profile'),
                  isAdminUser && React.createElement('button', { className: 'admin-button', onClick: () => setShowAdminModal(true) }, ' Admin'),
                  React.createElement('div', { className: 'position' }, `(${Math.round(position.x)}, ${Math.round(position.y)})${isTimedOut ? ' - TIMED OUT' : ''}`)
              ),
              React.createElement('div', { className: 'chat-box' },
                  React.createElement('div', { className: 'chat-header' },
                      React.createElement('div', null, 'Chat'),
                      React.createElement('select', {
                          className: 'chat-recipient',
                          value: chatChannel,
                          onChange: (e) => setChatChannel(e.target.value)
                      },
                          React.createElement('option', { value: 'all' }, 'All'),
                          friends.map(f => React.createElement('option', { key: `private:${f}`, value: `private:${f}` }, `Private: ${f}`)),
                          friendGroups.map(g => React.createElement('option', { key: `group:${g.id}`, value: `group:${g.id}` }, `Group: ${g.name}`))
                      )
                  ),
                  React.createElement('div', { className: 'chat-messages' },
                      chatMessages.slice().reverse().map(m =>
                          React.createElement('div', { key: m.id, className: 'chat-message' },
                              isAdminUser && React.createElement('button', {
                                  className: 'delete-msg-btn',
                                  onClick: () => deleteMessage(m.id)
                              }, ''),
                              React.createElement('div', { className: 'chat-meta' },
                                  React.createElement('div', null, m.username),
                                  renderChatTag(m.username)
                              ),
                              React.createElement('div', null, m.text)
                          )
                      )
                  ),
                  React.createElement('form', { onSubmit: handleChatSend, style: { display: 'flex' } },
                      React.createElement('input', {
                          className: 'chat-input',
                          value: chatInput,
                          onChange: handleChatChange,
                          onKeyDown: onChatKeyDown,
                          placeholder: isTimedOut ? 'You are timed out' : 'lowercase letters only',
                          maxLength: 200,
                          autoComplete: 'off',
                          disabled: !!isTimedOut
                      }),
                      React.createElement('button', { type: 'button', className: 'chat-send-btn', onClick: handleChatSend, disabled: !!isTimedOut }, 'Send')
                  ),
                  React.createElement('div', { style: { marginTop: 6, fontSize: 11, color: '#9ca3af', textAlign:'center' } },
                      isTimedOut ? `Timed out: ${formatRemaining(timedOutRemaining)}` : `Cooldown: ${CHAT_COOLDOWN_MS/1000}s | Type /clear to clear`
                  )
              ),
              showModal && React.createElement('div', { className: 'modal-overlay', onClick: () => setShowModal(false) },
                  React.createElement('div', { className: 'modal', onClick: (e) => e.stopPropagation() },
                      React.createElement('div', { className: 'modal-title' }, 'Choose Your Character'),
                      React.createElement('div', { className: 'character-grid' },
                          Object.keys(characters).map(key =>
                              React.createElement('div', {
                                  key,
                                  className: `character-option ${selectedCharacter === key ? 'selected' : ''}`,
                                  onClick: () => {
                                      setSelectedCharacter(key);
                                      set(ref(db, `players/${playerId.current}`), {
                                          username,
                                          x: position.x,
                                          y: position.y,
                                          character: key,
                                          admin: adminNames.includes(username.toLowerCase())
                                      });
                                      setShowModal(false);
                                  }
                              },
                                  React.createElement('img', { src: characters[key].image, alt: characters[key].name, className: 'character-image', onError: (e)=>{ e.target.src = characters['aurababy'].image; } }),
                                  React.createElement('div', { className: 'character-name' }, characters[key].name)
                              )
                          )
                      ),
                      React.createElement('button', { className: 'close-modal', onClick: () => setShowModal(false) }, 'Close')
                  )
              ),
              showFriendsModal && React.createElement('div', { className: 'modal-overlay', onClick: () => setShowFriendsModal(false) },
                  React.createElement('div', { className: 'modal', onClick: (e) => e.stopPropagation() },
                      React.createElement('div', { className: 'modal-title' }, 'Friends & Social'),
                      React.createElement('div', { className: 'tab-row' },
                          React.createElement('div', { className: `tab ${friendsTab === 'friends' ? 'active' : ''}`, onClick: () => setFriendsTab('friends') }, `Friends (${friends.length})`),
                          React.createElement('div', { className: `tab ${friendsTab === 'requests' ? 'active' : ''}`, onClick: () => setFriendsTab('requests') }, `Requests (${friendRequests.length})`),
                          React.createElement('div', { className: `tab ${friendsTab === 'blocked' ? 'active' : ''}`, onClick: () => setFriendsTab('blocked') }, `Blocked (${blockedUsers.length})`),
                          React.createElement('div', { className: `tab ${friendsTab === 'mailbox' ? 'active' : ''}`, onClick: () => setFriendsTab('mailbox') }, `Mailbox (${mailbox.length})`),
                          React.createElement('div', { className: `tab ${friendsTab === 'groups' ? 'active' : ''}`, onClick: () => setFriendsTab('groups') }, `Groups (${friendGroups.length})`)
                      ),
                      friendsTab === 'friends' && React.createElement('div', null,
                          React.createElement('div', { style: { marginBottom: 12 } },
                              React.createElement('button', { className: 'small-btn', onClick: () => {
                                  const target = window.prompt('Enter username to add as friend:');
                                  if (target) sendFriendRequest(target);
                              } }, 'Send Friend Request')
                          ),
                          friends.length === 0 ? React.createElement('div', { className: 'muted' }, 'No friends yet') :
                              React.createElement('div', { className: 'friend-list' },
                                  friends.map(f => React.createElement('div', { key: f, className: 'friend-item' },
                                      React.createElement('div', { className: 'friend-name' }, f),
                                      React.createElement('div', { className: 'friend-actions' },
                                          React.createElement('button', { className: 'small-btn ghost', onClick: () => {
                                              const msg = window.prompt(`Send mail to ${f}:`);
                                              if (msg) sendMailToFriend(f, msg);
                                          } }, 'Send Mail'),
                                          React.createElement('button', { className: 'small-btn ghost', onClick: () => setChatChannel(`private:${f}`) }, 'Chat'),
                                          React.createElement('button', { className: 'small-btn warn', onClick: () => {
                                              if (window.confirm(`Remove ${f} from friends?`)) removeFriend(f);
                                          } }, 'Remove')
                                      )
                                  ))
                              )
                      ),
                      friendsTab === 'requests' && React.createElement('div', null,
                          friendRequests.length === 0 ? React.createElement('div', { className: 'muted' }, 'No pending requests') :
                              React.createElement('div', { className: 'friend-list' },
                                  friendRequests.map(r => React.createElement('div', { key: r, className: 'friend-item' },
                                      React.createElement('div', { className: 'friend-name' }, r),
                                      React.createElement('div', { className: 'friend-actions' },
                                          React.createElement('button', { className: 'small-btn', onClick: () => acceptFriendRequest(r) }, 'Accept'),
                                          React.createElement('button', { className: 'small-btn warn', onClick: async () => {
                                              await remove(ref(db, `friends/${username.toLowerCase()}/requests/${r}`));
                                          } }, 'Decline')
                                      )
                                  ))
                              )
                      ),
                      friendsTab === 'blocked' && React.createElement('div', null,
                          React.createElement('div', { style: { marginBottom: 12 } },
                              React.createElement('button', { className: 'small-btn', onClick: () => {
                                  const target = window.prompt('Enter username to block:');
                                  if (target) blockUser(target);
                              } }, 'Block User')
                          ),
                          blockedUsers.length === 0 ? React.createElement('div', { className: 'muted' }, 'No blocked users') :
                              React.createElement('div', { className: 'friend-list' },
                                  blockedUsers.map(b => React.createElement('div', { key: b, className: 'friend-item' },
                                      React.createElement('div', { className: 'friend-name' }, b),
                                      React.createElement('div', { className: 'friend-actions' },
                                          React.createElement('button', { className: 'small-btn', onClick: () => unblockUser(b) }, 'Unblock')
                                      )
                                  ))
                              )
                      ),
                      friendsTab === 'mailbox' && React.createElement('div', null,
                          mailbox.length === 0 ? React.createElement('div', { className: 'muted' }, 'No mail') :
                              mailbox.map(mail => React.createElement('div', { key: mail.id, className: 'mail-item' },
                                  React.createElement('div', { className: 'mail-header' },
                                      React.createElement('div', { className: 'mail-from' }, `From: ${mail.from}`),
                                      React.createElement('button', { className: 'small-btn warn', onClick: () => deleteMail(mail.id) }, 'Delete')
                                  ),
                                  React.createElement('div', { className: 'mail-body' }, mail.text)
                              ))
                      ),
                      friendsTab === 'groups' && React.createElement('div', null,
                          React.createElement('div', { style: { marginBottom: 12 } },
                              React.createElement('button', { className: 'small-btn', onClick: () => {
                                  const name = window.prompt('Group name:');
                                  if (!name) return;
                                  const membersStr = window.prompt('Enter friend usernames (comma-separated):');
                                  if (!membersStr) return;
                                  const members = membersStr.split(',').map(m => m.trim()).filter(Boolean);
                                  createFriendGroup(name, members);
                              } }, 'Create Group')
                          ),
                          friendGroups.length === 0 ? React.createElement('div', { className: 'muted' }, 'No groups') :
                              friendGroups.map(g => React.createElement('div', { key: g.id, className: 'group-item', onClick: () => setChatChannel(`group:${g.id}`) },
                                  React.createElement('div', { className: 'group-name' }, g.name),
                                  React.createElement('div', { className: 'group-members' }, `Members: ${(g.members || []).join(', ')}`)
                              ))
                      ),
                      React.createElement('button', { className: 'close-modal', onClick: () => setShowFriendsModal(false) }, 'Close')
                  )
              ),
              showAdminModal && isAdminUser && React.createElement('div', { className: 'modal-overlay', onClick: () => setShowAdminModal(false) },
                  React.createElement('div', { className: 'modal', onClick: (e) => e.stopPropagation() },
                      React.createElement('div', { className: 'modal-title' }, 'Admin Panel'),
                      React.createElement('div', { className: 'tab-row' },
                          React.createElement('div', { className: `tab ${adminTab === 'players' ? 'active' : ''}`, onClick: () => setAdminTab('players') }, 'Players'),
                          React.createElement('div', { className: `tab ${adminTab === 'bans' ? 'active' : ''}`, onClick: () => setAdminTab('bans') }, `Bans (${Object.keys(moderation.bans || {}).length})`),
                          React.createElement('div', { className: `tab ${adminTab === 'timeouts' ? 'active' : ''}`, onClick: () => setAdminTab('timeouts') }, `Timeouts (${Object.keys(moderation.timeouts || {}).length})`)
                      ),
                      adminTab === 'players' && React.createElement('div', { className: 'admin-panel' },
                          React.createElement('div', { className: 'admin-column' },
                              React.createElement('div', { className: 'muted' }, `Active players (${uniquePlayerUsernames.length})`),
                              uniquePlayerUsernames.map(u =>
                                  React.createElement('div', { className: 'admin-row', key: u },
                                      React.createElement('div', { className: 'meta' },
                                          React.createElement('div', { style: { fontWeight: 700 } }, u),
                                          moderation.bans[u.toLowerCase()] && React.createElement('div', { className: 'muted' }, ' banned'),
                                          moderation.timeouts[u.toLowerCase()] && React.createElement('div', { className: 'muted' }, ' timed out')
                                      ),
                                      React.createElement('div', { style: { display: 'flex', gap: 4, flexWrap: 'wrap' } },
                                          React.createElement('select', {
                                              value: nameTags[u.toLowerCase()] || 'none',
                                              onChange: (e) => {
                                                  const v = e.target.value;
                                                  assignTag(u, v === 'none' ? 'none' : v);
                                              },
                                              style: { padding: '4px 6px', borderRadius: 6, fontSize: 12 }
                                          },
                                              React.createElement('option', { value: 'none' }, 'No Tag'),
                                              React.createElement('option', { value: 'gold' }, 'Gold'),
                                              React.createElement('option', { value: 'green' }, 'Green'),
                                              React.createElement('option', { value: 'red' }, 'Red'),
                                              React.createElement('option', { value: 'purple' }, 'Purple'),
                                              React.createElement('option', { value: 'black' }, 'Black')
                                          ),
                                          React.createElement('button', { className: 'small-btn ghost', onClick: () => {
                                              const dur = window.prompt('Ban duration (e.g., 11s, 8m, 2h, 2h-4m-10s, perm):', '11s');
                                              if (!dur) return;
                                              const reason = window.prompt('Ban reason:', '');
                                              applyModeration(u, 'ban', dur, reason);
                                          } }, 'Ban'),
                                          React.createElement('button', { className: 'small-btn ghost', onClick: () => {
                                              const dur = window.prompt('Timeout duration (e.g., 11s, 8m, 2h, 2h-4m-10s, perm):', '1m');
                                              if (!dur) return;
                                              const reason = window.prompt('Timeout reason:', '');
                                              applyModeration(u, 'timeout', dur, reason);
                                          } }, 'Timeout'),
                                          React.createElement('button', { className: 'small-btn ghost', onClick: () => {
                                              if (window.confirm(`Unban ${u}?`)) removeModeration(u, 'ban');
                                          } }, 'Unban'),
                                          React.createElement('button', { className: 'small-btn ghost', onClick: () => {
                                              if (window.confirm(`Remove timeout for ${u}?`)) removeModeration(u, 'timeout');
                                          } }, 'Untimeout')
                                      )
                                  )
                              )
                          )
                      ),
                      adminTab === 'bans' && React.createElement('div', { className: 'admin-panel' },
                          React.createElement('div', { className: 'admin-column' },
                              React.createElement('div', { className: 'muted' }, 'Banned users'),
                              Object.entries(moderation.bans || {}).length === 0 && React.createElement('div', { className: 'muted' }, 'No banned users'),
                              Object.entries(moderation.bans || {}).map(([k, v]) =>
                                  React.createElement('div', { className: 'admin-row', key: k },
                                      React.createElement('div', { className: 'meta' },
                                          React.createElement('div', { style: { fontWeight: 700 } }, k),
                                          React.createElement('div', { className: 'muted' }, v.moderator ? ` by ${v.moderator}` : ''),
                                          v.reason && React.createElement('div', { className: 'muted' }, `Reason: ${v.reason}`)
                                      ),
                                      React.createElement('div', null,
                                          React.createElement('button', { className: 'small-btn', onClick: () => removeModeration(k, 'ban') }, 'Unban')
                                      )
                                  )
                              )
                          )
                      ),
                      adminTab === 'timeouts' && React.createElement('div', { className: 'admin-panel' },
                          React.createElement('div', { className: 'admin-column' },
                              React.createElement('div', { className: 'muted' }, 'Timed out users'),
                              Object.entries(moderation.timeouts || {}).length === 0 && React.createElement('div', { className: 'muted' }, 'No timeouts'),
                              Object.entries(moderation.timeouts || {}).map(([k, v]) =>
                                  React.createElement('div', { className: 'admin-row', key: k },
                                      React.createElement('div', { className: 'meta' },
                                          React.createElement('div', { style: { fontWeight: 700 } }, k),
                                          React.createElement('div', { className: 'muted' }, v.moderator ? ` by ${v.moderator}` : ''),
                                          v.reason && React.createElement('div', { className: 'muted' }, `Reason: ${v.reason}`)
                                      ),
                                      React.createElement('div', null,
                                          React.createElement('button', { className: 'small-btn', onClick: () => removeModeration(k, 'timeout') }, 'Untimeout')
                                      )
                                  )
                              )
                          )
                      ),
                      React.createElement('button', { className: 'close-modal', onClick: () => setShowAdminModal(false) }, 'Close Admin Panel')
                  )
              ),
              showProfileModal && React.createElement('div', { className: 'modal-overlay', onClick: () => setShowProfileModal(false) },
                  React.createElement(ProfileModal, {
                      profileTarget: profileTarget,
                      username: username,
                      selectedCharacter: selectedCharacter,
                      players: players,
                      onClose: () => setShowProfileModal(false)
                  })
              ),
              selfModeration && React.createElement('div', { className: 'mod-overlay' },
                  React.createElement('div', { className: 'mod-card' },
                      React.createElement('div', { className: 'mod-title' }, selfModeration.type === 'ban' ? 'Banned' : 'Error'),
                      selfModeration.expiresAt == null
                          ? React.createElement('div', { className: 'mod-perm' }, 'This is permanent.')
                          : React.createElement('div', { className: 'mod-desc' }, `You will be able to rejoin when the timer ends.`),
                      React.createElement('img', { className: 'flash-img', src: MOD_FLASH_IMAGE, alt: 'moderation', onError: (e)=>{ e.target.style.display='none'; } }),
                      selfModeration.expiresAt == null
                          ? React.createElement('div', { className: 'mod-countdown' }, 'Permanent')
                          : React.createElement('div', { className: 'mod-countdown' }, formatRemaining(countdown)),
                      React.createElement('div', { className: 'mod-desc' }, selfModeration.moderator ? `Moderator: ${selfModeration.moderator}` : ''),
                      selfModeration.reason && React.createElement('div', { className: 'mod-desc' }, `Reason: ${selfModeration.reason}`)
                  )
              )
          );
      }
      ReactDOM.render(React.createElement(MovementHub), document.getElementById('root'));
    </script>
  </body>
</html>
